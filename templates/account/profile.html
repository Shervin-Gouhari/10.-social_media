{% extends "base.html" %}
{% load static %}
{% load post_tags %}
{% block title %} Profile {% endblock title %}
{% block style %}<link rel="stylesheet" href="{% static 'css/profile.css' %}">{% endblock style %}

{% block content %}
<main>
    <header>
        <div class="header-wrap">
            <div class="profile-pic">
                <img src="{{user.avatar.url}}" alt="profile-logo" />
            </div>
            <div class="profile-info">
                <div class="title row">
                    <h2 style="font-weight: bold;">{{user}}</h2>
                    {% if request.user == user %}
                        <a href="{% url 'edit_profile' request.user %}" class="btn btn-primary">Edit Profile</a>
                        <button id="post-pop-up-button"><i style="color: dodgerblue;" class="far fa-plus-square"></i></button>
                    {% else %}
                        <button class="btn btn-outline-primary" id="follow-btn" data-userId="{{user.id}}" data-userAction="{% if request.user in user.followers.all %}unfollow{% else %}follow{% endif %}">
                            {% if request.user in user.followers.all %}Unfollow{% else %}Follow{% endif %}  
                        </button>
                    {% endif %}
                    <button class="btn profile-settings-btn"><i style="font-size: 30px;" class="fas fa-cog"></i></button> 
                </div>
                <div class="desktop-only">
                    <div class="details row">
                        <ul>
                            <li><span>{{user.posts.all|length}}</span> posts</li>
                            <li><span id="followers-counter">{{user.followers.all|length}}</span> followers</li>
                            <li><span>{{user.following.all|length}}</span> following</li>
                        </ul>
                    </div>
                    <div class="descriptions row last" style="display: block;">
                        <span>{% if user.first_name %} {{user.first_name}} {% endif %}</span>
                        <span>{% if user.last_name %} {{user.last_name}} {% endif %}</span>
                        <div>{% if user.biography %} {{user.biography}} {% endif %}</div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <ul class="stories">
        <li class="story-item">
            <div class="image">
                <img src="{% static 'image/no_user_avatar.png' %}" />
            </div>
            <div class="title">TESTING</div>
        </li>
        <button class="slider-button-next desktop-only">
            <div class="arrow-right-icon"></div>
        </button>
    </ul>
    <div class="desktop-only">
        <div class="tabs">
            <div class="tab-item active" style="margin-right: 60px">
                <svg
                    aria-label="Posts"
                    class="_8-yf5"
                    fill="#262626"
                    height="12"
                    viewBox="0 0 48 48"
                    width="12"
                >
                    <path
                        clip-rule="evenodd"
                        d="M45 1.5H3c-.8 0-1.5.7-1.5 1.5v42c0 .8.7 1.5 1.5 1.5h42c.8 0 1.5-.7 1.5-1.5V3c0-.8-.7-1.5-1.5-1.5zm-40.5 3h11v11h-11v-11zm0 14h11v11h-11v-11zm11 25h-11v-11h11v11zm14 0h-11v-11h11v11zm0-14h-11v-11h11v11zm0-14h-11v-11h11v11zm14 28h-11v-11h11v11zm0-14h-11v-11h11v11zm0-14h-11v-11h11v11z"
                        fill-rule="evenodd"
                    ></path>
                </svg>
                <span>POSTS</span>
            </div>
            <div class="tab-item" style="margin-right: 60px">
                <svg
                    aria-label="Posts"
                    class="_8-yf5"
                    fill="#8e8e8e"
                    height="12"
                    viewBox="0 0 48 48"
                    width="12"
                >
                    <path
                        d="M41 10c-2.2-2.1-4.8-3.5-10.4-3.5h-3.3L30.5 3c.6-.6.5-1.6-.1-2.1-.6-.6-1.6-.5-2.1.1L24 5.6 19.7 1c-.6-.6-1.5-.6-2.1-.1-.6.6-.7 1.5-.1 2.1l3.2 3.5h-3.3C11.8 6.5 9.2 7.9 7 10c-2.1 2.2-3.5 4.8-3.5 10.4v13.1c0 5.7 1.4 8.3 3.5 10.5 2.2 2.1 4.8 3.5 10.4 3.5h13.1c5.7 0 8.3-1.4 10.5-3.5 2.1-2.2 3.5-4.8 3.5-10.4V20.5c0-5.7-1.4-8.3-3.5-10.5zm.5 23.6c0 5.2-1.3 7-2.6 8.3-1.4 1.3-3.2 2.6-8.4 2.6H17.4c-5.2 0-7-1.3-8.3-2.6-1.3-1.4-2.6-3.2-2.6-8.4v-13c0-5.2 1.3-7 2.6-8.3 1.4-1.3 3.2-2.6 8.4-2.6h13.1c5.2 0 7 1.3 8.3 2.6 1.3 1.4 2.6 3.2 2.6 8.4v13zM34.6 25l-9.1 2.8v-3.7c0-.5-.2-.9-.6-1.2-.4-.3-.9-.4-1.3-.2l-11.1 3.4c-.8.2-1.2 1.1-1 1.9.2.8 1.1 1.2 1.9 1l9.1-2.8v3.7c0 .5.2.9.6 1.2.3.2.6.3.9.3.1 0 .3 0 .4-.1l11.1-3.4c.8-.2 1.2-1.1 1-1.9s-1.1-1.2-1.9-1z"
                    ></path>
                </svg>
                <span>SAVED</span>
            </div>
            <div class="tab-item">
                <svg
                    aria-label="Tagged"
                    class="_8-yf5"
                    fill="#8e8e8e"
                    height="12"
                    viewBox="0 0 48 48"
                    width="12"
                >
                    <path
                        d="M41.5 5.5H30.4c-.5 0-1-.2-1.4-.6l-4-4c-.6-.6-1.5-.6-2.1 0l-4 4c-.4.4-.9.6-1.4.6h-11c-3.3 0-6 2.7-6 6v30c0 3.3 2.7 6 6 6h35c3.3 0 6-2.7 6-6v-30c0-3.3-2.7-6-6-6zm-29.4 39c-.6 0-1.1-.6-1-1.2.7-3.2 3.5-5.6 6.8-5.6h12c3.4 0 6.2 2.4 6.8 5.6.1.6-.4 1.2-1 1.2H12.1zm32.4-3c0 1.7-1.3 3-3 3h-.6c-.5 0-.9-.4-1-.9-.6-5-4.8-8.9-9.9-8.9H18c-5.1 0-9.4 3.9-9.9 8.9-.1.5-.5.9-1 .9h-.6c-1.7 0-3-1.3-3-3v-30c0-1.7 1.3-3 3-3h11.1c1.3 0 2.6-.5 3.5-1.5L24 4.1 26.9 7c.9.9 2.2 1.5 3.5 1.5h11.1c1.7 0 3 1.3 3 3v30zM24 12.5c-5.3 0-9.6 4.3-9.6 9.6s4.3 9.6 9.6 9.6 9.6-4.3 9.6-9.6-4.3-9.6-9.6-9.6zm0 16.1c-3.6 0-6.6-2.9-6.6-6.6 0-3.6 2.9-6.6 6.6-6.6s6.6 2.9 6.6 6.6c0 3.6-3 6.6-6.6 6.6z"
                    ></path>
                </svg>
                <span>TAGGED</span>
            </div>
        </div>
    </div>
    <div class="gallery" id="gallery">
        {% for post in posts_orderByCreationAscending %}
            <a class="gallery-item" tabindex="0" href="{{ post.get_absolute_url }}">
                {% if post.media.first|extension == 'image' %}
                    <img src="{{post.media.first.media.url}}" alt="gallery-post">
                    {% if post.media.count > 1 %}
                        <span class="eapps-instagram-feed-posts-item-image-icon-carousel eapps-instagram-feed-posts-item-image-icon es-post-type">
                            <svg viewBox="0 0 45.964 45.964">
                                <path
                                    d="M32.399,40.565H11.113v1.297c0,2.24,1.838,4.051,4.076,4.051h26.733c2.239,0,4.042-1.811,4.042-4.051V15.13c0-2.237-1.803-4.068-4.042-4.068h-1.415v21.395C40.507,36.904,36.845,40.566,32.399,40.565z"
                                ></path>
                                <path
                                    d="M0,4.102l0,28.355c0,2.241,1.814,4.067,4.051,4.067h28.365c2.237,0,4.066-1.826,4.066-4.067l0-28.356c0-2.238-1.828-4.051-4.066-4.051H4.051C1.814,0.05,0,1.862,0,4.102z"
                                ></path>
                            </svg>
                        </span>
                    {% endif %}  
                {% else %}
                    <video src="{{post.media.first.media.url}}#t=1" alt="gallery-post" preload="auto"></video>
                    {% if post.media.count == 1 %}
                        <span class="eapps-instagram-feed-posts-item-image-icon-video eapps-instagram-feed-posts-item-image-icon es-post-type">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M23.467,5.762c-0.118-0.045-0.232-0.068-0.342-0.068c-0.246,0-0.451,0.087-0.615,0.26l-3.76,3.217v5.766l3.76,3.578c0.164,0.173,0.369,0.26,0.615,0.26c0.109,0,0.223-0.023,0.342-0.068C23.822,18.552,24,18.284,24,17.901V6.57C24,6.186,23.822,5.917,23.467,5.762z"
                                ></path>
                                <path
                                    d="M16.33,4.412c-0.77-0.769-1.696-1.154-2.78-1.154H3.934c-1.084,0-2.01,0.385-2.78,1.154C0.385,5.182,0,6.108,0,7.192v9.616c0,1.084,0.385,2.01,1.154,2.78c0.77,0.77,1.696,1.154,2.78,1.154h9.616c1.084,0,2.01-0.385,2.78-1.154c0.77-0.77,1.154-1.696,1.154-2.78v-3.076v-3.478V7.192C17.484,6.108,17.099,5.182,16.33,4.412z M8.742,17.229c-2.888,0-5.229-2.341-5.229-5.229c0-2.888,2.341-5.229,5.229-5.229S13.971,9.112,13.971,12C13.971,14.888,11.63,17.229,8.742,17.229z"
                                ></path>
                                <circle cx="8.742" cy="12" r="3.5"></circle>
                            </svg>
                        </span>
                    {% else %}
                        <span class="eapps-instagram-feed-posts-item-image-icon-carousel eapps-instagram-feed-posts-item-image-icon es-post-type">
                            <svg viewBox="0 0 45.964 45.964">
                                <path
                                    d="M32.399,40.565H11.113v1.297c0,2.24,1.838,4.051,4.076,4.051h26.733c2.239,0,4.042-1.811,4.042-4.051V15.13c0-2.237-1.803-4.068-4.042-4.068h-1.415v21.395C40.507,36.904,36.845,40.566,32.399,40.565z"
                                ></path>
                                <path
                                    d="M0,4.102l0,28.355c0,2.241,1.814,4.067,4.051,4.067h28.365c2.237,0,4.066-1.826,4.066-4.067l0-28.356c0-2.238-1.828-4.051-4.066-4.051H4.051C1.814,0.05,0,1.862,0,4.102z"
                                ></path>
                            </svg>
                        </span>
                    {% endif %}
                {% endif %}
                <div class="gallery-item-info">
                    <ul style="margin-bottom: 10px;">
                        <li style="color: white; font-size: 20px; padding-right: 10px;"><i class="fas fa-heart" aria-hidden="true"></i> {{post.total_likes|human_format:"symbolic"}}</li>
                        <li style="color: white; font-size: 20px;"><i class="fas fa-comment" aria-hidden="true"></i> {{post.comments.all|length|human_format:"symbolic"}}</li>
                    </ul>
                    {% if post.caption %}
                        <ul style="margin-bottom: 0;">
                            <li style="color: white; font-size: 20px; text-align: center;"><i aria-hidden="true">{{post.caption|truncatechars:100}}</i></li>
                        </ul>
                    {% endif %}
                </div>
            </a>
        {% endfor %}
    </div>
    {% if user.posts.all|length > 6 %}
        <div style="display: flex; justify-content: center; margin: 20px;"><button id="load-more-button" class="btn btn-dark">load more</button></div>
    {% endif %}
</main>

<script src="{% static 'js/profile/create_post.js' %}"></script>
<script src="{% static 'js/profile/post_loader.js' %}"></script>
<script src="{% static 'js/profile/follow_unfollow.js' %}"></script>
{% endblock content %}

